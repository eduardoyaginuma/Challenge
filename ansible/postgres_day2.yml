3Ô∏è‚É£ Playbook Ansible ‚Äì PostgreSQL (Dia 2)

Este playbook executa:
- Backup
- Restore
- Status check
- Start/Stop
- Cria√ß√£o de usu√°rio
- Cria√ß√£o de database

üìú Playbook
---
- name: Operacoes Dia 2 - PostgreSQL
  hosts: postgres_primary
  become: yes
  vars:
    backup_dir: /var/backups/postgresql
    db_name: discounts
    db_user: app_user
    db_password: strong_password

  tasks:

    - name: Garantir diret√≥rio de backup
      file:
        path: "{{ backup_dir }}"
        state: directory
        owner: postgres
        group: postgres
        mode: '0755'

    - name: Backup do banco de dados
      become_user: postgres
      command: >
        pg_dump {{ db_name }} >
        {{ backup_dir }}/{{ db_name }}_{{ ansible_date_time.date }}.sql

    - name: Verificar status do PostgreSQL
      service:
        name: postgresql
        state: started

    - name: Criar usu√°rio da aplica√ß√£o
      become_user: postgres
      postgresql_user:
        name: "{{ db_user }}"
        password: "{{ db_password }}"
        role_attr_flags: LOGIN

    - name: Criar banco de dados
      become_user: postgres
      postgresql_db:
        name: "{{ db_name }}"
        owner: "{{ db_user }}"

üîé Por que isso demonstra conhecimento avan√ßado?

- Uso de m√≥dulos espec√≠ficos (postgresql_user, postgresql_db)
- Separa√ß√£o por host group
- Controle de privil√©gios
- Backup automatizado
- Idempot√™ncia

Pode ser expandido com:
- WAL archiving
- PITR restore
- Healthcheck SQL
- Valida√ß√£o de replica√ß√£o
